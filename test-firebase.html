<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>–¢–µ—Å—Ç Firebase - Elite Fitness</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <style>
        body {
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            color: white;
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            padding: 2rem;
        }
        .test-box {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 1rem;
        }
        .status-ok {
            color: #4ecdc4;
        }
        .status-error {
            color: #ff6b6b;
        }
        .btn {
            background: linear-gradient(135deg, #ff6b6b, #4ecdc4);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            margin: 0.5rem;
        }
    </style>
</head>
<body>
    <div class="max-w-4xl mx-auto">
        <h1 class="text-4xl font-bold mb-8">üî• –¢–µ—Å—Ç Firebase</h1>

        <!-- Connection Test -->
        <div class="test-box">
            <h2 class="text-2xl font-bold mb-4">1. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Firebase</h2>
            <div id="connectionStatus">–ü—Ä–æ–≤–µ—Ä–∫–∞...</div>
        </div>

        <!-- Auth Test -->
        <div class="test-box">
            <h2 class="text-2xl font-bold mb-4">2. –¢–µ—Å—Ç Authentication</h2>
            <div class="mb-4">
                <input type="email" id="testEmail" placeholder="test@example.com"
                       class="bg-white bg-opacity-10 border border-white border-opacity-20 rounded-lg px-4 py-2 w-full mb-2">
                <input type="password" id="testPassword" placeholder="password123"
                       class="bg-white bg-opacity-10 border border-white border-opacity-20 rounded-lg px-4 py-2 w-full mb-2">
                <button onclick="testRegister()" class="btn">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
                <button onclick="testLogin()" class="btn">–í–æ–π—Ç–∏</button>
            </div>
            <div id="authStatus"></div>
        </div>

        <!-- Firestore Test -->
        <div class="test-box">
            <h2 class="text-2xl font-bold mb-4">3. –¢–µ—Å—Ç Firestore</h2>
            <button onclick="testFirestore()" class="btn">–ó–∞–ø–∏—Å–∞—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
            <button onclick="testFirestoreRead()" class="btn">–ü—Ä–æ—á–∏—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
            <div id="firestoreStatus" class="mt-4"></div>
        </div>

        <!-- Results -->
        <div class="test-box">
            <h2 class="text-2xl font-bold mb-4">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:</h2>
            <div id="results"></div>
        </div>
    </div>

    <!-- Firebase Config & Service -->
    <script src="js/firebase-config.js"></script>
    <script src="js/firebase-service.js"></script>

    <script>
        let testResults = {
            connection: false,
            auth: false,
            firestore: false
        };

        // Test 1: Connection
        window.addEventListener('load', () => {
            setTimeout(() => {
                if (typeof firebase !== 'undefined' && firebase.apps.length > 0) {
                    document.getElementById('connectionStatus').innerHTML =
                        '<span class="status-ok">‚úÖ Firebase –ø–æ–¥–∫–ª—é—á–µ–Ω —É—Å–ø–µ—à–Ω–æ!</span><br>' +
                        '<small>Project ID: ' + firebaseApp.options.projectId + '</small>';
                    testResults.connection = true;
                } else {
                    document.getElementById('connectionStatus').innerHTML =
                        '<span class="status-error">‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Firebase</span>';
                }
                updateResults();
            }, 1000);
        });

        // Test 2: Registration
        async function testRegister() {
            const email = document.getElementById('testEmail').value || 'test@example.com';
            const password = document.getElementById('testPassword').value || 'password123';

            document.getElementById('authStatus').innerHTML = '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è...';

            try {
                const result = await registerUser(email, password, '–¢–µ—Å—Ç–æ–≤—ã–π –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å', {
                    age: 25,
                    gender: 'male',
                    height: 180,
                    currentWeight: 75
                });

                if (result.success) {
                    document.getElementById('authStatus').innerHTML =
                        '<span class="status-ok">‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!</span><br>' +
                        '<small>User ID: ' + result.user.uid + '</small>';
                    testResults.auth = true;
                } else {
                    document.getElementById('authStatus').innerHTML =
                        '<span class="status-error">‚ùå –û—à–∏–±–∫–∞: ' + result.error + '</span>';
                }
            } catch (error) {
                document.getElementById('authStatus').innerHTML =
                    '<span class="status-error">‚ùå –û—à–∏–±–∫–∞: ' + error.message + '</span>';
            }
            updateResults();
        }

        // Test 2b: Login
        async function testLogin() {
            const email = document.getElementById('testEmail').value || 'test@example.com';
            const password = document.getElementById('testPassword').value || 'password123';

            document.getElementById('authStatus').innerHTML = '–í—Ö–æ–¥...';

            try {
                const result = await loginUser(email, password);

                if (result.success) {
                    document.getElementById('authStatus').innerHTML =
                        '<span class="status-ok">‚úÖ –í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω!</span><br>' +
                        '<small>User ID: ' + result.user.uid + '</small>';
                    testResults.auth = true;
                } else {
                    document.getElementById('authStatus').innerHTML =
                        '<span class="status-error">‚ùå –û—à–∏–±–∫–∞: ' + result.error + '</span>';
                }
            } catch (error) {
                document.getElementById('authStatus').innerHTML =
                    '<span class="status-error">‚ùå –û—à–∏–±–∫–∞: ' + error.message + '</span>';
            }
            updateResults();
        }

        // Test 3: Firestore Write
        async function testFirestore() {
            const user = getCurrentUser();
            if (!user) {
                document.getElementById('firestoreStatus').innerHTML =
                    '<span class="status-error">‚ùå –°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ!</span>';
                return;
            }

            document.getElementById('firestoreStatus').innerHTML = '–ó–∞–ø–∏—Å—å –≤ Firestore...';

            try {
                const result = await addWorkout(user.uid, {
                    program: '–¢–µ—Å—Ç–æ–≤–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞',
                    duration: 30,
                    date: new Date().toISOString(),
                    completed: true
                });

                if (result.success) {
                    document.getElementById('firestoreStatus').innerHTML =
                        '<span class="status-ok">‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∞–Ω—ã –≤ Firestore!</span><br>' +
                        '<small>Workout ID: ' + result.id + '</small>';
                    testResults.firestore = true;
                } else {
                    document.getElementById('firestoreStatus').innerHTML =
                        '<span class="status-error">‚ùå –û—à–∏–±–∫–∞: ' + result.error + '</span>';
                }
            } catch (error) {
                document.getElementById('firestoreStatus').innerHTML =
                    '<span class="status-error">‚ùå –û—à–∏–±–∫–∞: ' + error.message + '</span>';
            }
            updateResults();
        }

        // Test 3b: Firestore Read
        async function testFirestoreRead() {
            const user = getCurrentUser();
            if (!user) {
                document.getElementById('firestoreStatus').innerHTML =
                    '<span class="status-error">‚ùå –°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ!</span>';
                return;
            }

            document.getElementById('firestoreStatus').innerHTML = '–ß—Ç–µ–Ω–∏–µ –∏–∑ Firestore...';

            try {
                const result = await getUserWorkouts(user.uid);

                if (result.success) {
                    document.getElementById('firestoreStatus').innerHTML =
                        '<span class="status-ok">‚úÖ –î–∞–Ω–Ω—ã–µ –ø—Ä–æ—á–∏—Ç–∞–Ω—ã –∏–∑ Firestore!</span><br>' +
                        '<small>–ù–∞–π–¥–µ–Ω–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫: ' + result.data.length + '</small>';
                    testResults.firestore = true;
                } else {
                    document.getElementById('firestoreStatus').innerHTML =
                        '<span class="status-error">‚ùå –û—à–∏–±–∫–∞: ' + result.error + '</span>';
                }
            } catch (error) {
                document.getElementById('firestoreStatus').innerHTML =
                    '<span class="status-error">‚ùå –û—à–∏–±–∫–∞: ' + error.message + '</span>';
            }
            updateResults();
        }

        function updateResults() {
            const total = Object.values(testResults).filter(v => v).length;
            const resultsDiv = document.getElementById('results');

            let html = '<div class="space-y-2">';
            html += '<div>' + (testResults.connection ? '‚úÖ' : '‚è≥') + ' Firebase –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</div>';
            html += '<div>' + (testResults.auth ? '‚úÖ' : '‚è≥') + ' Authentication</div>';
            html += '<div>' + (testResults.firestore ? '‚úÖ' : '‚è≥') + ' Firestore Database</div>';
            html += '</div>';
            html += '<div class="mt-4 text-2xl font-bold">';
            html += '–ü—Ä–æ–π–¥–µ–Ω–æ: ' + total + '/3';
            html += '</div>';

            if (total === 3) {
                html += '<div class="mt-4 text-green-400 text-xl">üéâ –í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–ª–∏—á–Ω–æ!</div>';
            }

            resultsDiv.innerHTML = html;
        }
    </script>
</body>
</html>
